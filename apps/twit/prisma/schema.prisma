// twit_db/schema.prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_TWIT_URL")
}

// í´ë¼ì´ì–¸íŠ¸ ìƒì„±ê¸° ì„¤ì •
generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/@prisma/client-twit"
}

// userProfile model ë³µì œ
model UserProfile {
  id        String   @id @default(uuid())
  userId    String   @unique // Auth ì„œë¹„ìŠ¤ì˜ User IDì™€ ì—°ê²°ê³ ë¦¬! (ì¤‘ìš”)
  email     String   @unique
  nickname  String  
  bio       String?  
  avatarUrl String?  
}

model Twit {
  id        String   @id @default(uuid())
  content   String
  authorId  String   // ì‘ì„±ìì˜ ID (User ì„œë¹„ìŠ¤ì˜ ê·¸ ID)
  authorNickname String // ì‘ì„±ì ë‹‰ë„¤ì„
  authorAvatarUrl String // ì‘ì„±ì í”„ì‚¬ URL
  createdAt DateTime @default(now())
  likeCount Int      @default(0) 
  retwitCount Int    @default(0)
  commentCount Int   @default(0)

  likes     Like[]
  retwits   Retwit[]
  comments  Comment[]
}

model Like {
  id        String   @id @default(uuid())
  twitId    String
  userId    String   // ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒ ID
  twit      Twit     @relation(fields: [twitId], references: [id])
  createdAt DateTime @default(now())

  @@unique([twitId, userId]) // í•œ íŠ¸ìœ—ì— ì¢‹ì•„ìš”ëŠ” í•œ ë²ˆë§Œ
}

model Retwit {
  id        String   @id @default(uuid())
  twitId    String
  userId    String   // ë¦¬íŠ¸ìœ—í•œ ì‚¬ëŒ ID
  createdAt DateTime @default(now())
  twit      Twit     @relation(fields: [twitId], references: [id])

  @@unique([twitId, userId]) // í•œ íŠ¸ìœ—ì— ë¦¬íŠ¸ìœ—ì€ í•œ ë²ˆë§Œ
}
model Comment {
  id        String   @id @default(uuid())
  twitId    String
  authorId  String   // ëŒ“ê¸€ ì‘ì„±ì ID
  authorNickname String // ëŒ“ê¸€ ì‘ì„±ì ë‹‰ë„¤ì„
  authorAvatarUrl String // ëŒ“ê¸€ ì‘ì„±ì í”„ì‚¬ URL
  commentLikesCount Int @default(0) // ëŒ“ê¸€ ì¢‹ì•„ìš” ìˆ˜ 
  content   String
  createdAt DateTime @default(now())
  parentId  String?  // ğŸ‘ˆ ë¶€ëª¨ ëŒ“ê¸€ ID (nullì´ë©´ ìµœìƒìœ„ ëŒ“ê¸€)
  
  twit      Twit     @relation(fields: [twitId], references: [id])
  parent    Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies   Comment[] @relation("CommentReplies")  // ëŒ€ëŒ“ê¸€ë“¤
  commentLikes     CommentLike[]
}

model CommentLike {
  id        String   @id @default(uuid())
  commentId String
  userId    String   // ëŒ“ê¸€ ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒ ID
  comment   Comment  @relation(fields: [commentId], references: [id])
  createdAt DateTime @default(now())
  @@unique([commentId, userId]) // í•œ ëŒ“ê¸€ì— ì¢‹ì•„ìš”ëŠ” í•œ ë²ˆë§Œ
}